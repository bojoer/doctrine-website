<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>

<meta name="generator" content="PHPDoctor 2RC4 (http://phpdoctor.sourceforge.net/)">
<meta name="when" content="Fri, 09 Apr 2010 11:50:25 -0400">

<link rel="stylesheet" type="text/css" href="../stylesheet.css">
<link rel="start" href="../overview-summary.html">

<title>Doctrine_Connection_UnitOfWork (Doctrine 1.2 ORM)</title>

</head>
<body id="definition" onload="parent.document.title=document.title;">

<div class="header">
<h1>Doctrine</h1>
<ul>
<li><a href="../overview-summary.html">Overview</a></li>
<li><a href="../doctrine/package-summary.html">Namespace</a></li>
<li class="active">Class</li>
<li><a href="../doctrine/package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../index.html" target="_top">Frames</a>
<a href="../doctrine/doctrine_connection_unitofwork.html" target="_top">No frames</a>
</div>
<div class="small_links">
Summary: <a href="#summary_field">Field</a> | <a href="#summary_method">Method</a> | <a href="#summary_constr">Constr</a>
Detail: <a href="#detail_field">Field</a> | <a href="#detail_method">Method</a> | <a href="#summary_constr">Constr</a>
</div>
<hr>

<div class="qualifiedName">Doctrine\Doctrine_Connection_UnitOfWork</div>
<div class="location">/Doctrine/Connection/UnitOfWork.php at line 40</div>

<h1>Class Doctrine_Connection_UnitOfWork</h1>

<pre class="tree">Class:Doctrine_Connection_UnitOfWork - Superclass: Doctrine_Connection_Module
<a href="../doctrine/doctrine_connection_module.html">Doctrine_Connection_Module</a><br>   &lfloor;&nbsp;<strong>Doctrine_Connection_UnitOfWork</strong><br /></pre>

<hr>

<p class="signature">public  class <strong>Doctrine_Connection_UnitOfWork</strong><br>extends <a href="../doctrine/doctrine_connection_module.html">Doctrine_Connection_Module</a>

</p>

<div class="comment" id="overview_description"><p>Doctrine_Connection_UnitOfWork</p><p>Note: This class does not have the semantics of a real "Unit of Work" in 0.10/1.0.
Database operations are not queued. All changes to objects are immediately written
to the database. You can think of it as a unit of work in auto-flush mode.</p><p>Referential integrity is currently not always ensured.</p></div>

<dl>
<dt>Subpackage:</dt>
<dd>Connection</dd>
<dt>License:</dt>
<dd>http://www.opensource.org/licenses/lgpl-license.php LGPL</dd>
<dt>See Also:</dt>
<dd><code>www.doctrine-project.org</code></dd>
<dt>Since:</dt>
<dd>1.0</dd>
<dt>Version:</dt>
<dd>$Revision: 7490 $</dd>
<dt>Author:</dt>
<dd>Konsta Vesterinen <kvesteri@cc.hut.fi></dd>
<dd>Roman Borschel <roman@code-factory.org></dd>
</dl>
<hr>

<table class="inherit">
<tr><th colspan="2">Fields inherited from Doctrine\Doctrine_Connection_Module</th></tr>
<tr><td><a href="../doctrine/doctrine_connection_module.html#conn">conn</a>, <a href="../doctrine/doctrine_connection_module.html#moduleName">moduleName</a></td></tr></table>

<table id="summary_method">
<tr><th colspan="2">Method Summary</th></tr>
<tr>
<td class="type">protected  void</td>
<td class="description"><p class="name"><a href="#_assignIdentifier()">_assignIdentifier</a>(mixed record)</p></td>
</tr>
<tr>
<td class="type">protected  void</td>
<td class="description"><p class="name"><a href="#_assignSequence()">_assignSequence</a>(mixed record, mixed fields)</p></td>
</tr>
<tr>
<td class="type">private  string</td>
<td class="description"><p class="name"><a href="#_buildSqlCompositeKeyCondition()">_buildSqlCompositeKeyCondition</a>(mixed columnNames, integer numRecords, <a href="../doctrine/doctrine_table.html">Doctrine_Table</a> table)</p><p class="description">Builds the SQL condition to target multiple records who have a composite primary key..</p></td>
</tr>
<tr>
<td class="type">private  string</td>
<td class="description"><p class="name"><a href="#_buildSqlSingleKeyCondition()">_buildSqlSingleKeyCondition</a>(mixed columnNames, integer numRecords, <a href="../doctrine/doctrine_table.html">Doctrine_Table</a> table)</p><p class="description">Builds the SQL condition to target multiple records who have a single-column
primary key..</p></td>
</tr>
<tr>
<td class="type">protected  void</td>
<td class="description"><p class="name"><a href="#_cascadeDelete()">_cascadeDelete</a>(mixed record, mixed deletions, <a href="../doctrine/doctrine_record.html">Doctrine_Record</a> The)</p><p class="description">Cascades an ongoing delete operation to related objects. </p></td>
</tr>
<tr>
<td class="type">private  void</td>
<td class="description"><p class="name"><a href="#_collectDeletions()">_collectDeletions</a>(mixed record, array deletions)</p><p class="description">Collects all records that need to be deleted by applying defined
application-level delete cascades..</p></td>
</tr>
<tr>
<td class="type">private  void</td>
<td class="description"><p class="name"><a href="#_deleteCTIParents()">_deleteCTIParents</a>(mixed table, mixed record)</p><p class="description">Class Table Inheritance code.
</p></td>
</tr>
<tr>
<td class="type">private  void</td>
<td class="description"><p class="name"><a href="#_executeDeletions()">_executeDeletions</a>(array deletions)</p><p class="description">Executes the deletions for all collected records during a delete operation
(usually triggered through $record->delete())..</p></td>
</tr>
<tr>
<td class="type">private  void</td>
<td class="description"><p class="name"><a href="#_formatDataSet()">_formatDataSet</a>(mixed record)</p><p class="description">Class Table Inheritance code.
</p></td>
</tr>
<tr>
<td class="type">private  void</td>
<td class="description"><p class="name"><a href="#_insertCTIRecord()">_insertCTIRecord</a>(mixed table, mixed record)</p><p class="description">Class Table Inheritance code.
</p></td>
</tr>
<tr>
<td class="type">private  void</td>
<td class="description"><p class="name"><a href="#_postDelete()">_postDelete</a>(mixed record)</p><p class="description">Invokes postDelete event listeners..</p></td>
</tr>
<tr>
<td class="type">private  boolean</td>
<td class="description"><p class="name"><a href="#_preDelete()">_preDelete</a>(mixed record)</p><p class="description">Invokes preDelete event listeners..</p></td>
</tr>
<tr>
<td class="type">private  void</td>
<td class="description"><p class="name"><a href="#_updateCTIRecord()">_updateCTIRecord</a>(mixed table, mixed record)</p><p class="description">Class Table Inheritance code.
</p></td>
</tr>
<tr>
<td class="type"> array</td>
<td class="description"><p class="name"><a href="#buildFlushTree()">buildFlushTree</a>(array tables)</p><p class="description">buildFlushTree
builds a flush tree that is used in transactions.</p></td>
</tr>
<tr>
<td class="type"> boolean</td>
<td class="description"><p class="name"><a href="#delete()">delete</a>(mixed record)</p><p class="description">Deletes the given record and all the related records that participate
in an application-level delete cascade.
</p></td>
</tr>
<tr>
<td class="type"> boolean</td>
<td class="description"><p class="name"><a href="#insert()">insert</a>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</p><p class="description">Inserts a record into database.
</p></td>
</tr>
<tr>
<td class="type"> void</td>
<td class="description"><p class="name"><a href="#processSingleInsert()">processSingleInsert</a>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</p><p class="description">Inserts a transient record in its table.
</p></td>
</tr>
<tr>
<td class="type"> boolean</td>
<td class="description"><p class="name"><a href="#replace()">replace</a>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</p><p class="description">Replaces a record into database..</p></td>
</tr>
<tr>
<td class="type"> void</td>
<td class="description"><p class="name"><a href="#saveAll()">saveAll</a>()</p><p class="description">saveAll
persists all the pending records from all tables.</p></td>
</tr>
<tr>
<td class="type"> void</td>
<td class="description"><p class="name"><a href="#saveAssociations()">saveAssociations</a>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</p><p class="description">saveAssociations.</p></td>
</tr>
<tr>
<td class="type"> void</td>
<td class="description"><p class="name"><a href="#saveGraph()">saveGraph</a>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record, mixed replace)</p><p class="description">Saves the given record and all associated records.
</p></td>
</tr>
<tr>
<td class="type"> void</td>
<td class="description"><p class="name"><a href="#saveRelatedForeignKeys()">saveRelatedForeignKeys</a>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</p><p class="description">saveRelatedForeignKeys
saves all related (through ForeignKey) records to $record.</p></td>
</tr>
<tr>
<td class="type"> void</td>
<td class="description"><p class="name"><a href="#saveRelatedLocalKeys()">saveRelatedLocalKeys</a>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</p><p class="description">saveRelatedLocalKeys
saves all related (through LocalKey) records to $record.</p></td>
</tr>
<tr>
<td class="type"> boolean</td>
<td class="description"><p class="name"><a href="#update()">update</a>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</p><p class="description">updates given record.</p></td>
</tr>
</table>

<table class="inherit">
<tr><th colspan="2">Methods inherited from Doctrine\Doctrine_Connection_Module</th></tr>
<tr><td><a href="../doctrine/doctrine_connection_module.html#getConnection()">getConnection</a>, <a href="../doctrine/doctrine_connection_module.html#getModuleName()">getModuleName</a></td></tr></table>

<h2 id="detail_method">Method Detail</h2>
<div class="location">/Doctrine/Connection/UnitOfWork.php at line 919</div>
<h3 id="_assignIdentifier()">_assignIdentifier</h3>
<code class="signature">protected  void <strong>_assignIdentifier</strong>(mixed record)</code>
<div class="details">
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 901</div>
<h3 id="_assignSequence()">_assignSequence</h3>
<code class="signature">protected  void <strong>_assignSequence</strong>(mixed record, mixed fields)</code>
<div class="details">
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 300</div>
<h3 id="_buildSqlCompositeKeyCondition()">_buildSqlCompositeKeyCondition</h3>
<code class="signature">private  string <strong>_buildSqlCompositeKeyCondition</strong>(mixed columnNames, integer numRecords, <a href="../doctrine/doctrine_table.html">Doctrine_Table</a> table)</code>
<div class="details">
<p>Builds the SQL condition to target multiple records who have a composite primary key.</p><dl>
<dt>Parameters:</dt>
<dd>table - The table from which the records are going to be deleted.</dd>
<dd>numRecords - The number of records that are going to be deleted.</dd>
<dt>Returns:</dt>
<dd>The SQL condition "(pk1 = ? AND pk2 = ?) OR (pk1 = ? AND pk2 = ?) ..."</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 287</div>
<h3 id="_buildSqlSingleKeyCondition()">_buildSqlSingleKeyCondition</h3>
<code class="signature">private  string <strong>_buildSqlSingleKeyCondition</strong>(mixed columnNames, integer numRecords, <a href="../doctrine/doctrine_table.html">Doctrine_Table</a> table)</code>
<div class="details">
<p>Builds the SQL condition to target multiple records who have a single-column
primary key.</p><dl>
<dt>Parameters:</dt>
<dd>table - The table from which the records are going to be deleted.</dd>
<dd>numRecords - The number of records that are going to be deleted.</dd>
<dt>Returns:</dt>
<dd>The SQL condition "pk = ? OR pk = ? OR pk = ? ..."</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 329</div>
<h3 id="_cascadeDelete()">_cascadeDelete</h3>
<code class="signature">protected  void <strong>_cascadeDelete</strong>(mixed record, mixed deletions, <a href="../doctrine/doctrine_record.html">Doctrine_Record</a> The)</code>
<div class="details">
<p>Cascades an ongoing delete operation to related objects. Applies only on relations
that have 'delete' in their cascade options.
This is an application-level cascade. Related objects that participate in the
cascade and are not yet loaded are fetched from the database.
Exception: many-valued relations are always (re-)fetched from the database to
make sure we have all of them.</p><dl>
<dt>Parameters:</dt>
<dd>The - record for which the delete operation will be cascaded.</dd>
<dt>Throws:</dt>
<dd>If something went wrong at database level</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 177</div>
<h3 id="_collectDeletions()">_collectDeletions</h3>
<code class="signature">private  void <strong>_collectDeletions</strong>(mixed record, array deletions)</code>
<div class="details">
<p>Collects all records that need to be deleted by applying defined
application-level delete cascades.</p><dl>
<dt>Parameters:</dt>
<dd>deletions - Map of the records to delete. Keys=Oids Values=Records.</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 790</div>
<h3 id="_deleteCTIParents()">_deleteCTIParents</h3>
<code class="signature">private  void <strong>_deleteCTIParents</strong>(mixed table, mixed record)</code>
<div class="details">
<p>Class Table Inheritance code.
Support dropped for 0.10/1.0.</p><p>Note: This is flawed. We also need to delete from subclass tables.</p></div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 193</div>
<h3 id="_executeDeletions()">_executeDeletions</h3>
<code class="signature">private  void <strong>_executeDeletions</strong>(array deletions)</code>
<div class="details">
<p>Executes the deletions for all collected records during a delete operation
(usually triggered through $record->delete()).</p><dl>
<dt>Parameters:</dt>
<dd>deletions - Map of the records to delete. Keys=Oids Values=Records.</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 866</div>
<h3 id="_formatDataSet()">_formatDataSet</h3>
<code class="signature">private  void <strong>_formatDataSet</strong>(mixed record)</code>
<div class="details">
<p>Class Table Inheritance code.
Support dropped for 0.10/1.0.</p></div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 804</div>
<h3 id="_insertCTIRecord()">_insertCTIRecord</h3>
<code class="signature">private  void <strong>_insertCTIRecord</strong>(mixed table, mixed record)</code>
<div class="details">
<p>Class Table Inheritance code.
Support dropped for 0.10/1.0.</p></div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 481</div>
<h3 id="_postDelete()">_postDelete</h3>
<code class="signature">private  void <strong>_postDelete</strong>(mixed record)</code>
<div class="details">
<p>Invokes postDelete event listeners.</p></div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 469</div>
<h3 id="_preDelete()">_preDelete</h3>
<code class="signature">private  boolean <strong>_preDelete</strong>(mixed record)</code>
<div class="details">
<p>Invokes preDelete event listeners.</p><dl>
<dt>Returns:</dt>
<dd>Whether a listener has used it's veto (don't delete!).</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 832</div>
<h3 id="_updateCTIRecord()">_updateCTIRecord</h3>
<code class="signature">private  void <strong>_updateCTIRecord</strong>(mixed table, mixed record)</code>
<div class="details">
<p>Class Table Inheritance code.
Support dropped for 0.10/1.0.</p></div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 650</div>
<h3 id="buildFlushTree()">buildFlushTree</h3>
<code class="signature">public  array <strong>buildFlushTree</strong>(array tables)</code>
<div class="details">
<p>buildFlushTree
builds a flush tree that is used in transactions</p><p>The returned array has all the initialized components in
'correct' order. Basically this means that the records of those
components can be saved safely in the order specified by the returned array.</p><dl>
<dt>Parameters:</dt>
<dd>tables - an array of Doctrine_Table objects or component names</dd>
<dt>Returns:</dt>
<dd>an array of component names in flushing order</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 164</div>
<h3 id="delete()">delete</h3>
<code class="signature">public  boolean <strong>delete</strong>(mixed record)</code>
<div class="details">
<p>Deletes the given record and all the related records that participate
in an application-level delete cascade.</p><p>this event can be listened by the onPreDelete and onDelete listeners</p><dl>
<dt>Returns:</dt>
<dd>true on success, false on failure</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 553</div>
<h3 id="insert()">insert</h3>
<code class="signature">public  boolean <strong>insert</strong>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</code>
<div class="details">
<p>Inserts a record into database.</p><p>This method inserts a transient record in the database, and adds it
to the identity map of its correspondent table. It proxies to @see 
processSingleInsert(), trigger insert hooks and validation of data
if required.</p><dl>
<dt>Returns:</dt>
<dd>false if record is not valid</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 622</div>
<h3 id="processSingleInsert()">processSingleInsert</h3>
<code class="signature">public  void <strong>processSingleInsert</strong>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</code>
<div class="details">
<p>Inserts a transient record in its table.</p><p>This method inserts the data of a single record in its assigned table, 
assigning to it the autoincrement primary key (if any is defined).</p></div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 585</div>
<h3 id="replace()">replace</h3>
<code class="signature">public  boolean <strong>replace</strong>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</code>
<div class="details">
<p>Replaces a record into database.</p><dl>
<dt>Returns:</dt>
<dd>false if record is not valid</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 495</div>
<h3 id="saveAll()">saveAll</h3>
<code class="signature">public  void <strong>saveAll</strong>()</code>
<div class="details">
<p>saveAll
persists all the pending records from all tables</p><dl>
<dt>Throws:</dt>
<dd>if something went wrong at database level</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 433</div>
<h3 id="saveAssociations()">saveAssociations</h3>
<code class="signature">public  void <strong>saveAssociations</strong>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</code>
<div class="details">
<p>saveAssociations</p><p>this method takes a diff of one-to-many / many-to-many original and
current collections and applies the changes</p><p>for example if original many-to-many related collection has records with
primary keys 1,2 and 3 and the new collection has records with primary keys
3, 4 and 5, this method would first destroy the associations to 1 and 2 and then
save new associations to 4 and 5</p><dl>
<dt>Throws:</dt>
<dd>if something went wrong at database level</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 49</div>
<h3 id="saveGraph()">saveGraph</h3>
<code class="signature">public  void <strong>saveGraph</strong>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record, mixed replace)</code>
<div class="details">
<p>Saves the given record and all associated records.
(The save() operation is always cascaded in 0.10/1.0).</p></div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 362</div>
<h3 id="saveRelatedForeignKeys()">saveRelatedForeignKeys</h3>
<code class="signature">public  void <strong>saveRelatedForeignKeys</strong>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</code>
<div class="details">
<p>saveRelatedForeignKeys
saves all related (through ForeignKey) records to $record</p><dl>
<dt>Throws:</dt>
<dd>if something went wrong at database level</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 382</div>
<h3 id="saveRelatedLocalKeys()">saveRelatedLocalKeys</h3>
<code class="signature">public  void <strong>saveRelatedLocalKeys</strong>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</code>
<div class="details">
<p>saveRelatedLocalKeys
saves all related (through LocalKey) records to $record</p><dl>
<dt>Throws:</dt>
<dd>if something went wrong at database level</dd>
</dl>
</div>

<hr>

<div class="location">/Doctrine/Connection/UnitOfWork.php at line 515</div>
<h3 id="update()">update</h3>
<code class="signature">public  boolean <strong>update</strong>(<a href="../doctrine/doctrine_record.html">Doctrine_Record</a> record)</code>
<div class="details">
<p>updates given record</p><dl>
<dt>Parameters:</dt>
<dd>record - record to be updated</dd>
<dt>Returns:</dt>
<dd>whether or not the update was successful</dd>
</dl>
</div>

<hr>

<div class="header">
<h1>Doctrine</h1>
<ul>
<li><a href="../overview-summary.html">Overview</a></li>
<li><a href="../doctrine/package-summary.html">Namespace</a></li>
<li class="active">Class</li>
<li><a href="../doctrine/package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../index.html" target="_top">Frames</a>
<a href="../doctrine/doctrine_connection_unitofwork.html" target="_top">No frames</a>
</div>
<div class="small_links">
Summary: <a href="#summary_field">Field</a> | <a href="#summary_method">Method</a> | <a href="#summary_constr">Constr</a>
Detail: <a href="#detail_field">Field</a> | <a href="#detail_method">Method</a> | <a href="#summary_constr">Constr</a>
</div>
<hr>

<p id="footer">This document was generated by <a href="http://peej.github.com/phpdoctor/">PHPDoctor: The PHP Documentation Creator</a></p>

</body>

</html>